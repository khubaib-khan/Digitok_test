Code Review: 
           1) Over All code is not bad just need small changes to handle worse case scenerios. 
           2) variable assignment was not done in proper places.
           3) other than that code indentation is quite good which make it readable.
           4)For me if some functionality implentation require more than few lines and its have a      possibility   to be reused we should write separate function to acoid code complexity.if it require variable data we can use parameter for. this approach is also applied in this code.
           5) in some cases like if and elseif worst case scenerios should be kept in mind because in any case neither of condition are satisfied getting variables defined in these block will throw errors which can be avoided by defining it before if or writing an else case.
           6)Function names are mostly self explainatory.
           7)Comments also make it easier to understand.     